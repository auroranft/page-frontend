import{d as j,r as s,w as K,e as X,o as u,c as h,a as e,i as _,h as V,g as D,t as L,N as r,_ as ne,s as ae,v as ue,n as oe,I as fe,p as se,m as le,J as E,k as J,j as R,K as ve,L as me,u as _e,F as pe,f as he,M as be,l as Ie}from"./entry-58e7afa6.mjs";import{u as ce,a as G,b as ye}from"./useSubmit-99431132.mjs";import{u as Q}from"./useWeb3-5d18194c.mjs";import{a as M,M as F}from"./Market_abi-93ee176c.mjs";import{T as U}from"./TokenERC20_abi-e6f25529.mjs";import{_ as ke,a as ge,b as we}from"./historyList-dda1ebec.mjs";import{u as xe}from"./asyncData-5962a627.mjs";const Be={style:{display:"inline-block"}},$e=["disabled"],Ce={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ne=j({__name:"nftBuy",props:{nftInfo:null},setup(p){const N=p,t=s();t.value=N.nftInfo;const f=ce(),T=G(),b=t.value.onSale&&!t.value.isBid,n=s(b),{account:o,library:v,chainId:a}=Q();K([o,T],()=>{!!o.value&&!!v.value&&!!a.value&&(n.value=b&&o.value!==t.value.owner)});const B=s(null),$=s("0"),c=s(!1),I=s(!1);async function C(){const d=M[a.value],y=new v.value.eth.Contract(F,d),m=await y.methods.txRoundIdByNFTId(t.value.nftId).call(),g=await y.methods.paymentMap(t.value.nftId,m).call();B.value=g.payToken,$.value=g.payAmount;const k=await y.methods.nftById(t.value.nftId).call(),S={...t,...k};t.value=S;const P=new v.value.eth.Contract(U,g.payToken),W=await P.methods.balanceOf(o.value).call();r.exports.greaterThanOrEqual(r.exports.BigInt(W),r.exports.BigInt($.value))?c.value=!0:c.value=!1;const Y=await P.methods.allowance(o.value,d).call();r.exports.greaterThanOrEqual(r.exports.BigInt(Y),r.exports.BigInt($.value))?I.value=!0:I.value=!1}async function A(){f.value=!0;const d=M[a.value],y=new v.value.eth.Contract(U,B.value),m=await y.methods.allowance(o.value,d).call();r.exports.lessThan(r.exports.BigInt(m),r.exports.BigInt($.value))?y.methods.approve(d,$.value).send({from:o.value}).then(()=>{O(d)}).catch(g=>{console.info(g),f.value=!1}):O(d)}function O(d){new v.value.eth.Contract(F,d).methods.buy(t.value.token,t.value.tokenId).send({from:o.value}).then(()=>{f.value=!1,T.value=Date.parse(new Date().toString())}).catch(m=>{console.info(m),f.value=!1})}return X(()=>{!!v.value&&!!o.value&&!!a.value&&(n.value=b&&o.value!==t.value.owner,C())}),(d,y)=>(u(),h("div",Be,[e("button",{class:"w-100 btn btn-primary",type:"button",disabled:!n.value||_(f),onClick:A},[_(f)?(u(),h("span",Ce)):V("",!0),D(" "+L(_(f)?"Loading...":"Buy now"),1)],8,$e)]))}}),q=p=>(se("data-v-0838ef2a"),p=p(),le(),p),Te={style:{display:"inline-block"}},Ae=["disabled"],Oe={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Le={class:"modal fade",id:"modalNftOffer",tabindex:"-1","aria-labelledby":"modalNftOfferLabel","aria-hidden":"true"},Se={class:"modal-dialog modal-lg modal-dialog-centered"},Me={class:"modal-content"},Fe=q(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"modalNftOfferLabel"},"Place an Offer"),e("button",{id:"closeModalNftOffer",type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),De={class:"modal-body"},Re={class:"row g-5"},qe={class:"col"},Pe={class:"my-4"},Ee=q(()=>e("label",{for:"amount",class:"form-label"},"Price",-1)),Ve=["min"],Ue=q(()=>e("div",{id:"validationAmountFeedback",class:"invalid-feedback"}," You must input amount ",-1)),je={class:"form-check"},He=q(()=>e("label",{class:"form-check-label fw-lighter",for:"agreenTerms"},"I approve NFTrade's Terms & Conditions",-1)),We=q(()=>e("hr",{class:"my-4"},null,-1)),Ye=["disabled"],ze={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Je=j({__name:"nftOffer",props:{nftInfo:null},setup(p){const N=p,t=s();t.value=N.nftInfo;const f=t.value.onSale&&t.value.isBid,T=s(f),b=s(!1),{account:n,library:o,chainId:v}=Q();K([n,b],()=>{!!n.value&&!!o.value&&!!v.value&&(T.value=f&&n.value!==t.value.owner&&!b.value)});const a=ce(),B=ye(),$=G(),c=s({token:t.value.token,tokenId:t.value.tokenId,amount:0,agreenTerms:!1}),I=s(0),C=s(null),A=s(0),O=s(!1),d=s(!1);async function y(){c.value.token=t.value.token,c.value.tokenId=t.value.tokenId;const l=M[v.value],i=new o.value.eth.Contract(F,l),w=await i.methods.txRoundIdByNFTId(t.value.nftId).call(),x=await i.methods.paymentMap(t.value.nftId,w).call();C.value=x.payToken,A.value=x.payAmount,b.value=parseInt(x.endTime)<=Date.parse(new Date().toString())/1e3;const z=await i.methods.nftById(t.value.nftId).call(),ie={...t,...z};t.value=ie;const te=new o.value.eth.Contract(U,x.payToken),re=await te.methods.balanceOf(n.value).call();r.exports.greaterThanOrEqual(r.exports.BigInt(re),r.exports.BigInt(A.value))?O.value=!0:O.value=!1;const de=await te.methods.allowance(n.value,l).call();r.exports.greaterThanOrEqual(r.exports.BigInt(de),r.exports.BigInt(A.value))?d.value=!0:d.value=!1}const m=s(0),g=s(0),k=s(!1),S=s(!1);async function P(){const l=new o.value.eth.Contract(F,M[v.value]),i=await l.methods.txRoundIdByNFTId(t.value.nftId).call(),w=await l.methods.offerLast(t.value.nftId,i).call();m.value=parseFloat(o.value.utils.fromWei(w.amount.toString(),"ether"));const x=await l.methods.getOfferList(t.value.nftId,i).call();g.value=x.length,x.length>0?I.value=m.value+1:I.value=m.value,k.value=!0}function W(l){g.value>0?k.value=parseFloat(l.target.value)>m.value:k.value=parseFloat(l.target.value)>=m.value}function Y(l){S.value=l.target.checked}async function Z(){if(B.value=!0,a.value=!0,c.value.amount=I.value,c.value.token&&c.value.tokenId&&k.value&&S.value){const l=M[v.value],i=o.value.utils.toWei(c.value.amount.toString(),"ether"),w=new o.value.eth.Contract(U,C.value),x=await w.methods.allowance(n.value,l).call();r.exports.lessThan(r.exports.BigInt(x),r.exports.BigInt(i))?w.methods.approve(l,i).send({from:n.value}).then(()=>{ee(l,i)}).catch(z=>{console.info(z),a.value=!1,B.value=!1}):ee(l,i)}else a.value=!1,B.value=!1}function ee(l,i){new o.value.eth.Contract(F,l).methods.offer(c.value.token,c.value.tokenId,i).send({from:n.value}).then(()=>{a.value=!1,B.value=!1,$.value=Date.parse(new Date().toString()),document.getElementById("closeModalNftOffer").click()}).catch(x=>{console.info(x),a.value=!1,B.value=!1})}return X(()=>{!!o.value&&!!n.value&&!!v.value&&(y(),P(),T.value=f&&n.value!==t.value.owner&&!b.value)}),(l,i)=>(u(),h("div",Te,[e("button",{class:"btn btn-danger",type:"button","data-bs-toggle":"modal","data-bs-target":"#modalNftOffer",disabled:!T.value||_(a),onClick:Z},[_(a)?(u(),h("span",Oe)):V("",!0),D(" "+L(_(a)?"Loading...":"Place an offer"),1)],8,Ae),e("div",Le,[e("div",Se,[e("div",Me,[Fe,e("div",De,[e("div",Re,[e("div",qe,[e("form",null,[e("div",Pe,[Ee,ae(e("input",{type:"number",class:oe(`form-control ${k.value?"is-valid":"is-invalid"}`),id:"amount","aria-describedby":"validationAmountFeedback","onUpdate:modelValue":i[0]||(i[0]=w=>I.value=w),min:m.value,max:"999999999999999999.999999999999999999",step:"0.000000000000000001",onInput:W,required:""},null,42,Ve),[[ue,I.value]]),Ue]),e("div",je,[ae(e("input",{type:"checkbox",class:oe(`form-check-input ${S.value?"is-valid":"is-invalid"}`),id:"agreenTerms","onUpdate:modelValue":i[1]||(i[1]=w=>c.value.agreenTerms=w),onClick:Y,required:""},null,2),[[fe,c.value.agreenTerms]]),He]),We,e("button",{class:"w-100 btn btn-primary btn-lg",type:"button",disabled:_(a)||!k.value||!S.value,onClick:Z},[_(a)?(u(),h("span",ze)):V("",!0),D(" "+L(_(a)?"Loading...":"Place Your Offer"),1)],8,Ye)])])])])])])])]))}});var Ke=ne(Je,[["__scopeId","data-v-0838ef2a"]]);const Xe=j({__name:"assets",props:{nftInfo:null},setup(p){const t=p.nftInfo;return(f,T)=>{const b=Ne,n=Ke,o=ve;return u(),E(o,null,{default:J(()=>[R(b,{nftInfo:_(t)},null,8,["nftInfo"]),R(n,{nftInfo:_(t),class:"ms-3"},null,8,["nftInfo"])]),_:1})}}}),H=p=>(se("data-v-6d104b92"),p=p(),le(),p),Ge={key:0,class:"py-5 container"},Qe={class:"row py-lg-5"},Ze={class:"col-lg-6 col-md-12"},et={class:"ratio ratio-1x1 nft-img"},tt=["src"],at={class:"col-lg-6 col-md-12"},ot={class:"card border-0"},nt={class:"card-body"},st={class:"card-text"},lt={key:0,class:"bi bi-patch-check-fill text-primary"},ct={class:"card-body"},it={class:"card-title"},rt={class:"card-text"},dt=D(" Owned by "),ut={class:"d-flex justify-content-start align-items-center"},ft=be('<div class="d-flex justify-content-start align-items-center pt-5 pb-5" id="list-example" data-v-6d104b92><a href="#history" data-v-6d104b92>History <i class="bi bi-link-45deg" data-v-6d104b92></i></a><a class="ms-3" href="#offers" data-v-6d104b92>Offers <i class="bi bi-link-45deg" data-v-6d104b92></i></a><a class="ms-3" href="#listings" data-v-6d104b92>Listings <i class="bi bi-link-45deg" data-v-6d104b92></i></a></div>',1),vt={class:"mb-5"},mt=H(()=>e("h4",null,"Properties",-1)),_t={class:"table table-bordered"},pt=H(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Property"),e("th",{scope:"col"},"Value")])],-1)),ht={key:0},bt={key:1},It=H(()=>e("tr",{class:"text-center fw-lighter"},[e("td",{colspan:"5"},"No Data")],-1)),yt=[It],kt={"data-bs-spy":"scroll","data-bs-target":"#list-example","data-bs-offset":"0","data-bs-smooth-scroll":"true",class:"scrollspy-example",tabindex:"0"},gt={class:"mb-5",id:"listings"},wt={class:"mb-5",id:"offers"},xt={class:"mb-5",id:"history"},Bt={key:1,class:"py-5 container"},$t=H(()=>e("div",{class:"row"},[e("div",{class:"text-center"},[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")])])],-1)),Ct=[$t],Nt=j({__name:"[token]-[tokenId]",setup(p){const N=G(),t=me(),f=t.params.token,T=t.params.tokenId,{$truncateAccount:b}=_e(),{account:n,library:o,chainId:v}=Q();K([n,N],()=>{n.value&&$()});const a=s();async function B(){const c=new o.value.eth.Contract(F,M[v.value]),I=await c.methods.nftIdMap(f,T).call(),C=await c.methods.nftById(I).call(),A=await c.methods.collectionMap(f).call(),{data:O}=await xe(I,()=>$fetch(C.tokenURI),"$UssXRS3pvH"),d={...C,collection:A,metadata:O.value};a.value=d}function $(){!!o.value&&!!n.value&&!!v.value&&B()}return X(()=>{$()}),(c,I)=>{var m,g;const C=Ie,A=Xe,O=ke,d=ge,y=we;return u(),h("main",null,[(m=a.value)!=null&&m.token?(u(),h("section",Ge,[e("div",Qe,[e("div",Ze,[e("div",et,[e("img",{src:(g=a.value.metadata)==null?void 0:g.fileUrl},null,8,tt)])]),e("div",at,[e("div",ot,[e("div",nt,[e("p",st,[R(C,{to:`/account/nfts/${a.value.collection.token}`},{default:J(()=>[D(L(a.value.collection.name),1)]),_:1},8,["to"]),a.value.collection.approve?(u(),h("i",lt)):V("",!0)])]),e("div",ct,[e("h3",it,L(a.value.metadata.name),1),e("p",rt,[dt,R(C,{to:`/account/${a.value.owner}`},{default:J(()=>[D(L(_(b)(a.value.owner)),1)]),_:1},8,["to"])]),e("div",ut,[R(A,{nftInfo:a.value},null,8,["nftInfo"])])])])])]),ft,e("div",vt,[mt,e("table",_t,[pt,a.value.metadata.properties.length>0?(u(),h("tbody",ht,[(u(!0),h(pe,null,he(a.value.metadata.properties,k=>(u(),h("tr",{key:k.property},[e("th",null,L(k.property),1),e("td",null,L(k.value),1)]))),128))])):(u(),h("tbody",bt,yt))])]),e("div",kt,[e("div",gt,[(u(),E(O,{nftInfo:a.value,key:_(N)},null,8,["nftInfo"]))]),e("div",wt,[(u(),E(d,{nftInfo:a.value,key:_(N)},null,8,["nftInfo"]))]),e("div",xt,[(u(),E(y,{nftInfo:a.value,key:_(N)},null,8,["nftInfo"]))])])])):(u(),h("section",Bt,Ct))])}}});var Dt=ne(Nt,[["__scopeId","data-v-6d104b92"]]);export{Dt as default};
